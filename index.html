<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tuktukturbo</title>
<link rel="stylesheet" href="style.css">
<link rel="icon" href="https://takenupload.com/69200ccfd62da" type="image/png">
</head>
<body>
<canvas id="particles"></canvas>

<div id="chat-container">
    <div id="header">AIXREY</div>
    <div id="messages"></div>
    <div id="input-container">
        <textarea id="prompt" placeholder="Tulis pesan..." rows="2"></textarea>
        <button id="send-btn">Kirim</button>
    </div>
</div>

<script>
/* ---------- Particles Animation ---------- */
const canvas = document.getElementById('particles');
const ctx = canvas.getContext('2d');
let w = canvas.width = window.innerWidth;
let h = canvas.height = window.innerHeight;
let particles = [];

window.addEventListener('resize', () => {
    w = canvas.width = window.innerWidth;
    h = canvas.height = window.innerHeight;
});

function createParticles(count){
    particles = [];
    for(let i=0;i<count;i++){
        particles.push({
            x: Math.random()*w,
            y: Math.random()*h,
            r: Math.random()*2+1,
            dx: (Math.random()-0.5)*0.5,
            dy: (Math.random()-0.5)*0.5
        });
    }
}

function drawParticles(){
    ctx.clearRect(0,0,w,h);
    particles.forEach(p => {
        ctx.beginPath();
        ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
        ctx.fillStyle = '#00eaff33';
        ctx.fill();
        p.x += p.dx;
        p.y += p.dy;
        if(p.x < 0 || p.x > w) p.dx*=-1;
        if(p.y < 0 || p.y > h) p.dy*=-1;
    });
    requestAnimationFrame(drawParticles);
}

createParticles(100);
drawParticles();

/* ---------- Chat Functionality ---------- */
const messagesEl = document.getElementById("messages");
const promptEl = document.getElementById("prompt");
const sendBtn = document.getElementById("send-btn");
let chatHistory = [];
let typingEl = null;

sendBtn.addEventListener("click", sendMessage);
promptEl.addEventListener("keypress", e => {
    if(e.key === "Enter" && !e.shiftKey){
        e.preventDefault();
        sendMessage();
    }
});

function addMessage(text, role, isTyping=false){
    const msgEl = document.createElement("div");
    msgEl.className = `message ${role}`;
    if(isTyping){
        msgEl.innerHTML = `<div class="typing"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>`;
        typingEl = msgEl;
    } else {
        msgEl.textContent = text;
        typingEl = null;
    }
    messagesEl.appendChild(msgEl);
    messagesEl.scrollTop = messagesEl.scrollHeight;
}

function removeTyping(){
    if(typingEl){
        messagesEl.removeChild(typingEl);
        typingEl = null;
    }
}

async function sendMessage(){
    const text = promptEl.value.trim();
    if(!text) return;
    addMessage(text,"user");
    chatHistory.push({role:"user", content:text});
    promptEl.value="";
    addMessage("", "assistant", true);

    try{
        const res = await fetch("https://apichax.csrynaldifusototo.workers.dev/", {
            method:"POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({
                messages: chatHistory,
                model: "meta-llama/Llama-3.2-3B-Instruct:novita",
                stream: false
            })
        });
        const data = await res.json();
        removeTyping();
        const reply = data.choices?.[0]?.message?.content || "No response";
        addMessage(reply,"assistant");
        chatHistory.push({role:"assistant", content:reply});
    } catch(e){
        removeTyping();
        addMessage("Error: "+e.message,"assistant");
    }
}
</script>
</body>
</html>
